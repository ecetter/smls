{% extends "base.html" %}

{% block title %}Setup SMLS OAuth Credentials{% endblock %}

{% block content %}
<div class="setup-container">
    <div class="setup-header">
        <h1 class="setup-title">
            <i class="fas fa-cog icon"></i>
            SMLS OAuth Credentials Setup
        </h1>
        <p class="setup-subtitle">
            Configure your Google and LinkedIn OAuth applications to enable secure authentication
        </p>
    </div>
    
    <!-- Current Credentials Display -->
    <div class="current-credentials">
        <h2 class="section-title">
            <i class="fas fa-key icon"></i>
            Current OAuth Credentials
        </h2>
        
        <div class="credentials-display">
            {% if session.oauth_credentials %}
                {% for provider, creds in session.oauth_credentials.items() %}
                    <div class="credential-item">
                        <div class="credential-info">
                            <div class="provider-logo {{ provider }}">
                                <i class="fab fa-{{ provider }}"></i>
                            </div>
                            <div class="credential-details">
                                <h3>{% if provider == 'google' %}Google{% else %}{{ provider|title }}{% endif %} OAuth</h3>
                                <p>Client ID: {{ creds.client_id[:8] }}...{{ creds.client_id[-4:] }}</p>
                                <p>Status: <span class="status-enabled">Enabled</span></p>
                            </div>
                        </div>
                        <div class="credential-actions">
                            <button type="button" class="btn btn-danger btn-sm" onclick="removeCredential('{{ provider }}')">
                                <i class="fas fa-trash icon"></i>
                                Remove
                            </button>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="no-credentials">
                    <i class="fas fa-info-circle"></i>
                    <p>No OAuth credentials configured yet.</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <form method="POST" action="{{ url_for('save_credentials') }}" class="setup-form">
        <div class="providers-grid">
            <!-- Google OAuth -->
            <div class="provider-card">
                <div class="provider-header">
                    <div class="provider-logo">
                        <i class="fab fa-google"></i>
                    </div>
                    <div class="provider-info">
                        <h3>Google OAuth</h3>
                        <p>Sign in with Google</p>
                    </div>
                    <div class="provider-toggle">
                        <input type="checkbox" id="google_enabled" name="google_enabled" class="form-check-input" 
                               {% if session.oauth_credentials and session.oauth_credentials.get('google') %}checked{% endif %}>
                        <label for="google_enabled" class="form-check-label">Enable</label>
                    </div>
                </div>
                
                <div class="provider-fields" id="google_fields">
                    <div class="form-group">
                        <label for="google_client_id" class="form-label">Client ID</label>
                        <input type="text" id="google_client_id" name="google_client_id" class="form-control" 
                               placeholder="Enter your Google Client ID">
                    </div>
                    
                    <div class="form-group">
                        <label for="google_client_secret" class="form-label">Client Secret</label>
                        <input type="password" id="google_client_secret" name="google_client_secret" class="form-control" 
                               placeholder="Enter your Google Client Secret">
                    </div>
                    
                    <div class="provider-help">
                        <h4>Setup Instructions:</h4>
                        <ol>
                            <li>Go to <a href="https://console.developers.google.com" target="_blank">Google Cloud Console</a></li>
                            <li>Create a new project or select existing one</li>
                            <li>Enable Google OAuth API</li>
                            <li>Create OAuth 2.0 credentials</li>
                            <li>Add authorized redirect URI: <code>{{ config.get_google_redirect_uri() }}</code></li>
                        </ol>
                    </div>
                </div>
            </div>
            
            <!-- LinkedIn OAuth -->
            <div class="provider-card">
                <div class="provider-header">
                    <div class="provider-logo">
                        <i class="fab fa-linkedin"></i>
                    </div>
                    <div class="provider-info">
                        <h3>LinkedIn OAuth</h3>
                        <p>Sign in with LinkedIn</p>
                    </div>
                    <div class="provider-toggle">
                        <input type="checkbox" id="linkedin_enabled" name="linkedin_enabled" class="form-check-input"
                               {% if session.oauth_credentials and session.oauth_credentials.get('linkedin') %}checked{% endif %}>
                        <label for="linkedin_enabled" class="form-check-label">Enable</label>
                    </div>
                </div>
                
                <div class="provider-fields" id="linkedin_fields">
                    <div class="form-group">
                        <label for="linkedin_client_id" class="form-label">Client ID</label>
                        <input type="text" id="linkedin_client_id" name="linkedin_client_id" class="form-control" 
                               placeholder="Enter your LinkedIn Client ID">
                    </div>
                    
                    <div class="form-group">
                        <label for="linkedin_client_secret" class="form-label">Client Secret</label>
                        <input type="password" id="linkedin_client_secret" name="linkedin_client_secret" class="form-control" 
                               placeholder="Enter your LinkedIn Client Secret">
                    </div>
                    
                    <div class="provider-help">
                        <h4>Setup Instructions:</h4>
                        <ol>
                            <li>Go to <a href="https://www.linkedin.com/developers" target="_blank">LinkedIn Developers</a></li>
                            <li>Create a new app</li>
                            <li>Add OAuth 2.0 scopes: <code>openid profile email</code></li>
                            <li>Add authorized redirect URI: <code>{{ config.get_linkedin_redirect_uri() }}</code></li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large">
                <i class="fas fa-save icon"></i>
                Save Credentials
            </button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left icon"></i>
                Back to Login
            </a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_head %}
<style>
.setup-container {
    max-width: 1000px;
    margin: 0 auto;
}

.setup-header {
    text-align: center;
    margin-bottom: 3rem;
}

.setup-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
}

.setup-title .icon {
    color: var(--accent-primary);
}

.setup-subtitle {
    font-size: 1.1rem;
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
}

/* Current Credentials */
.current-credentials {
    margin-bottom: 3rem;
    animation: slideUp 0.4s ease-out;
}

.section-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
}

.section-title .icon {
    color: var(--accent-primary);
}

.credentials-display {
    display: grid;
    gap: 1rem;
}

.credential-item {
    background: var(--gradient-card);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
}

.credential-item:hover {
    border-color: var(--accent-primary);
    box-shadow: var(--shadow-md);
}

.credential-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.credential-details h3 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.credential-details p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin: 0.25rem 0;
}

.status-enabled {
    color: var(--accent-success);
    font-weight: 600;
}

.credential-actions {
    display: flex;
    gap: 0.5rem;
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
}

.no-credentials {
    text-align: center;
    padding: 2rem;
    color: var(--text-muted);
}

.no-credentials i {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: var(--accent-primary);
}

.setup-form {
    animation: slideUp 0.6s ease-out;
}

.providers-grid {
    display: grid;
    gap: 2rem;
    margin-bottom: 3rem;
}

.provider-card {
    background: var(--gradient-card);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 2rem;
    transition: all 0.3s ease;
}

.provider-card:hover {
    border-color: var(--accent-primary);
    box-shadow: var(--shadow-lg);
}

.provider-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
}

.provider-logo {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
}

.provider-card:first-child .provider-logo {
    background: #ea4335;
}

.provider-card:last-child .provider-logo {
    background: #0077b5;
}

.provider-info {
    flex: 1;
}

.provider-info h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: var(--text-primary);
}

.provider-info p {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.provider-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.provider-fields {
    display: none;
    animation: slideUp 0.3s ease-out;
}

.provider-fields.active {
    display: block;
}

.provider-help {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 1.5rem;
}

.provider-help h4 {
    color: var(--text-primary);
    margin-bottom: 1rem;
    font-size: 1rem;
    font-weight: 600;
}

.provider-help ol {
    color: var(--text-secondary);
    padding-left: 1.5rem;
}

.provider-help li {
    margin-bottom: 0.5rem;
    line-height: 1.5;
}

.provider-help a {
    color: var(--accent-primary);
    text-decoration: none;
}

.provider-help a:hover {
    text-decoration: underline;
}

.provider-help code {
    background: var(--bg-tertiary);
    color: var(--accent-primary);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.875rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    padding-top: 2rem;
    border-top: 1px solid var(--border-color);
}

.btn-large {
    padding: 1rem 2rem;
    font-size: 1.1rem;
    min-height: 60px;
}

@media (max-width: 768px) {
    .setup-title {
        font-size: 2rem;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .provider-header {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .btn-large {
        width: 100%;
    }
}
</style>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Toggle provider fields based on checkbox state
    const googleCheckbox = document.getElementById('google_enabled');
    const linkedinCheckbox = document.getElementById('linkedin_enabled');
    const googleFields = document.getElementById('google_fields');
    const linkedinFields = document.getElementById('linkedin_fields');
    
    function toggleFields(checkbox, fields) {
        if (checkbox.checked) {
            fields.classList.add('active');
        } else {
            fields.classList.remove('active');
        }
    }
    
    googleCheckbox.addEventListener('change', () => toggleFields(googleCheckbox, googleFields));
    linkedinCheckbox.addEventListener('change', () => toggleFields(linkedinCheckbox, linkedinFields));
    
    // Initialize state
    toggleFields(googleCheckbox, googleFields);
    toggleFields(linkedinCheckbox, linkedinFields);
});

function removeCredential(provider) {
    if (confirm(`Are you sure you want to remove ${provider} OAuth credentials?`)) {
        // Create a form to submit the removal request
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/remove-credential';
        
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'provider';
        input.value = provider;
        
        form.appendChild(input);
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}